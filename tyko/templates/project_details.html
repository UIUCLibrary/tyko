{% extends "details_table.html" %}
{% from "_macros.html" import notes_table_row, note_editor_events, notes_table, metadata_table %}
{% from "_details_macros.html" import confirm_remove_entity_modal, add_field_row, child_entity_row, remove_modal_event_scripts %}
{% from "_object_macros.html" import object_new_button_row, new_object_modal%}
{% block detail_table -%}
    <div class="card my-1">
        <div class="card-body">
            {%  call metadata_table() %}
                {%- for field in fields %}
                    {{ add_field_row(field.name, field.key, (project.get(field.key) or ""), field.editable, api_path, loop.index) }}
                {%- endfor %}
            {% endcall %}
        </div>
    </div>
    <div class="card my-1">
        <div class="card-header">
            <h5 class="card-title">Objects</h5>
        </div>
        <div class="card-body">
            <table class="table">
                <caption hidden>Objects</caption>
                <thead>
                    <th scope="col" hidden>Object</th>
                    <th scope="col" hidden>Remove</th>
                </thead>
                <tbody>
                    {%- for child_object in project['objects'] %}
                        {{ child_entity_row(
                            child_object['name'],
                            url_for('page_project_object_details', project_id=project_id, object_id=child_object.object_id),
                            "removeObjectModal",
                            url_for('project_object', project_id=project_id, object_id=child_object.object_id)
                            ) }}
                    {%- endfor %}
                    {{ object_new_button_row(api_path + "/object", "newObjectModal") }}
                </tbody>
            </table>
            {{ confirm_remove_entity_modal("removeObjectModal") }}
            {{ new_object_modal("newObjectModal", collections, api_path + "/object") }}
        </div>
    </div>

    <div class="card">
        <h5 class="card-header">Notes</h5>
        <div class="card-body">
            {% call(note) notes_table(project['notes'], api_path) %}
                {{ notes_table_row(note, url_for('project_notes', project_id=project_id, note_id=note['note_id'])) }}
            {% endcall %}
        </div>
    </div>
{%- endblock -%}
{% block scripts %}
    {{ super() }}
    {{ remove_modal_event_scripts("removeObjectModal") }}
    {{ note_editor_events(api_path, valid_note_types) }}
{% endblock %}