{% from "_details_macros.html" import new_modal %}

{% macro new_item_form(formats) %}

<div class="form-group row">
    <label for="itemNameInput" class="col-sm-2 col-form-label">Name</label>
    <div class="col-sm-10">
        <input type="text" id="itemNameInput" class="form-control" name="name" required>
    </div>
</div>
<div class="form-group row">
    <label for="itemFormatSelection" class="col-sm-2 col-form-label">Format</label>
    <div class="col-sm-10">
        <select class="custom-select" class="form-control" name="format_id" id="itemFormatSelection" required>
            <option value="" disabled selected>Select a Format</option>
            {%- for format in formats%}
                <option value="{{format.format_types_id}}">{{ format.name }}</option>
            {%- endfor %}
        </select>
    </div>
</div>
<div class="form-group row">
    <label for="itemFilenameInput" class="col-sm-2 col-form-label">File Name</label>
    <div class="col-sm-10">
        <input type="text" id="itemFilenameInput" class="form-control" name="file_name">
    </div>
</div>
{% endmacro %}

{% macro new_item_modal(modal_id, formats, api_route) %}

{{new_modal(modal_id, "New Item", new_item_form(formats)) }}
<script type="module">

import {items} from "{{url_for('static', filename="js/api.js")}}"
const object_api_route = "{{ api_route }}";
$(document).ready(function () {
    $("#newEntity").unbind("submit").bind("submit",
        function(event) {
            event.preventDefault();
            const rawData = $(this).serializeArray();
            let data = {};
            for (let i=0; i < rawData.length; i++ ){
                data[rawData[i].name] = rawData[i].value;
            }
            items.addItem(object_api_route, data)
                .then(function(){
                    location.reload();
                })
                .catch(function(reason){
                    let alertBox = $("#submitResultAlert");
                    let responsesMessage =
                        '<div class="alert alert-danger alert-dismissible" role="alert" id="submitResultAlert">\n' +
                        '<strong id="errorMessage">';

                    responsesMessage += reason.statusText;
                    responsesMessage += "</strong>";
                    responsesMessage +=
                        '    <button type="button" class="close" data-dismiss="alert" aria-label="Close">\n' +
                        '        <span aria-hidden="true">&times;</span>\n' +
                        '    </button>\n' +
                        '</div>';
                    alertBox.html(responsesMessage);
                    console.error(reason.responseText)
                }
            );
            return false;
        }
    )
});
</script>
{% endmacro %}

{% macro item_new_button_row(api_for_new, modal_id) %}
<tr>
    <td></td>
    <td>
        <div class="btn-group float-right" role="group">
            <button class="btn btn-primary" data-toggle="modal" data-target="#{{modal_id}}">Add</button>
        </div>
    </td>
</tr>
{% endmacro %}

